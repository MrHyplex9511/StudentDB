<!DOCTYPE html>
<html>
<head>
  <title>Student Dashboard</title>
  <link rel="stylesheet" href="css/style.css">
  <script type="module" src="js/dashboard.js" defer></script>
</head>
<script src="js/clickspark.js"></script>
<body>
  <h1 id="welcome">Welcome, Student</h1>
  <p id="progressText"></p>
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <p>ðŸ“š Study material coming soon...</p>
  <!-- Percentage Popup -->
<div id="percentagePopup" class="popup">
  <div class="popup-content">
    <h2>Update Your Progress</h2>
    <label for="currentPercentage">Current %:</label>
    <input type="number" id="currentPercentage" min="0" max="100"><br>
    <label for="goalPercentage">Goal %:</label>
    <input type="number" id="goalPercentage" min="0" max="100"><br>
    <button id="savePercentageBtn">Save</button>
  </div>
</div>
<script type="module">
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
  import { app } from './js/firebase-init.js';

  const db = getFirestore(app);
  const auth = getAuth(app);

  const popup = document.getElementById("percentagePopup");
  const saveBtn = document.getElementById("savePercentageBtn");

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const userDoc = doc(db, "students", user.uid);
      const docSnap = await getDoc(userDoc);

      if (!docSnap.exists() || !docSnap.data().currentPercentage || !docSnap.data().goalPercentage) {
        popup.style.display = "flex"; // Show the popup
      }
    }
  });

  saveBtn.addEventListener("click", async () => {
    const current = parseFloat(document.getElementById("currentPercentage").value);
    const goal = parseFloat(document.getElementById("goalPercentage").value);

    if (!isNaN(current) && !isNaN(goal)) {
      const user = auth.currentUser;
      if (user) {
        const userDoc = doc(db, "students", user.uid);
        await setDoc(userDoc, {
          currentPercentage: current,
          goalPercentage: goal
        }, { merge: true });
        popup.style.display = "none";
      }
    } else {
      alert("Please enter valid numbers.");
    }
  });
</script>

</body>
</html>
